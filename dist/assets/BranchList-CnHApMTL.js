import{r as s,j as e,C as k,a as E,b as z,I as N,B as i,S as D,X as I,P as L,T,s as p}from"./index-D_GOMUGl.js";const q=({className:b})=>{const[f,c]=s.useState([]),[_,g]=s.useState(!0),[j,o]=s.useState(null),[h,d]=s.useState(""),[m,x]=s.useState(""),[y,u]=s.useState(null),[v,l]=s.useState(null);s.useEffect(()=>{let t=!0;return(async()=>{g(!0),l(null);const{data:n,error:r}=await p.from("paragraph_branches").select("*").order("created_at",{ascending:!1});r?(l("Failed to fetch branches."),c([])):n&&t&&c(n),g(!1)})(),()=>{t=!1}},[]);const C=t=>{o(t.id),d(t.branch_text),x(t.parent_paragraph_text)},w=()=>{o(null),d(""),x("")},B=async t=>{const{error:a}=await p.from("paragraph_branches").update({branch_text:h,parent_paragraph_text:m}).eq("id",t.id);a?l("Failed to update branch."):(c(n=>n.map(r=>r.id===t.id?{...r,branch_text:h,parent_paragraph_text:m}:r)),o(null),d(""),x(""),l(null))},S=async t=>{const{error:a}=await p.from("paragraph_branches").delete().eq("id",t);a?l("Failed to delete branch."):(c(n=>n.filter(r=>r.id!==t)),u(null),l(null))};return e.jsxs(k,{className:b,children:[e.jsx(E,{className:"text-base p-3 border-b bg-gradient-to-r from-pink-50 to-blue-50 dark:from-slate-800 dark:to-blue-900/40",children:"Branches"}),e.jsxs(z,{children:[v&&e.jsx("div",{className:"text-red-500 text-xs mb-2",children:v}),_?e.jsx("div",{className:"py-8 text-center text-gray-400 text-sm",children:"Loading branches..."}):f.length===0?e.jsx("div",{className:"py-8 text-center text-gray-400 text-sm",children:"No branches found."}):e.jsx("div",{className:"divide-y",children:f.map(t=>e.jsxs("div",{className:"py-3 flex flex-col gap-1 md:flex-row md:justify-between md:items-center",children:[j===t.id?e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row md:items-center gap-2",children:[e.jsx(N,{className:"flex-1",value:m,onChange:a=>x(a.target.value),placeholder:"Branch name",maxLength:120}),e.jsx(N,{className:"flex-1",value:h,onChange:a=>d(a.target.value),placeholder:"Branch text",maxLength:400}),e.jsx(i,{size:"sm",variant:"ghost",onClick:()=>B(t),children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx(i,{size:"sm",variant:"ghost",onClick:w,children:e.jsx(I,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm mb-1 truncate",children:t.parent_paragraph_text||e.jsx("span",{className:"italic text-gray-400",children:"Unnamed branch"})}),e.jsx("div",{className:"text-xs text-gray-700 dark:text-gray-300 mb-1 truncate",children:t.branch_text}),e.jsx("div",{className:"text-[10px] text-gray-400",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("div",{className:"flex items-center gap-1 mt-2 md:mt-0",children:j!==t.id&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:"icon",variant:"ghost","aria-label":"Edit",onClick:()=>C(t),children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx(i,{size:"icon",variant:"ghost","aria-label":"Delete",onClick:()=>u(t.id),children:e.jsx(T,{className:"w-4 h-4"})})]})}),y===t.id&&e.jsxs("div",{className:"absolute left-0 right-0 top-full mt-2 z-30 bg-white shadow border rounded p-4 flex flex-col gap-2 text-center",children:[e.jsx("div",{className:"text-sm",children:"Delete this branch?"}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(i,{size:"sm",variant:"destructive",onClick:()=>S(t.id),children:"Delete"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>u(null),children:"Cancel"})]})]})]},t.id))})]})]})};export{q as default};
